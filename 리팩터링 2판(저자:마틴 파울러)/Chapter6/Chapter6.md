# Chapter6. 기본적인 리팩터링

## <U>6.1 함수 추출하기</U>

### **배경**

- 함수 추출하기는 가장 많은 사용하는 리팩터링 기법중 하나인데, 코드 조각을 찾아 무슨일을 하는지 파악한 다음, 독립된 함수로 추출하고 목적에 맞는 이름을 붙여서 사용한다
- 코드를 언제 독립적 함수로 묶어야 하는지는 코드를 보고 무슨일을 하는지 파악하는데 시간이 한참 걸린다면 의심해 볼 수 있다
- 함수로 추출한뒤 '무슨 일'에 걸맞는 이름을 짓는다. 이렇게 해두면 나중에 코드를 다시 읽을 때 함수의 목적이 눈에 확 들어오고, 본문코드에 대해서는 더 이상 신경 쓸 일이 거의 없다
- 함수를 짧게 만듦녀 함수호출이 많아져서 성능이 느려질까 걱정하는 사람도 있다. 그러나 함수가 짧으면 캐싱하기가 더 쉽기 땜누에 컴파일러가 최적화하는데 유리할 때가 많다
- 긴 함수에는 각가의 코드 덩어리 첫머리에 그 목적을 설명하는 주석이 달려있을 때가 많다. 해당 코드 덩어리를 추출한 함수의 이름을 지을 때 이 주석을 참고하면 도움이 될 것이다

### **절차**

1. 함수를 새로 만들고 목적을 잘 드러내는 이름을 붙인다 ('어떻게'가 아닌 '무엇을'하는지가 드러나야 한다)
2. 추출할 코드를 원본 함수에서 복사하여 새 함수에 붙여넣는다
3. 추출한 코드 중 원본 함수의 지역 변수를 참조하거나 추출한 함수의 유효범위를 벗어나는 변수는 없는지 검사한다. 있다면 매개변수로 전달한다
4. 변수를 다 처리했다면 컴파일한다
5. 원본 함수에서 추출한 코드 부분을 새로 만든 함수를 호출하는 문장으로 바꾼다(즉,추출한 함수로 일을 위임한다)
6. 테스트한다
7. 다른 코드에 방금 추출한 것과 똑같거나 비슷한 코드가 없는지 살핀다. 있다면 방금 추출한 새 함수를 호출하도록 바꿀지 검토한다 (인라인 코드를 함수 호출로 바꾸기)

### **예시**

- **ExtractFunctionExample.md 파일 참조**

## <U>6.2 함수 인라인하기</U>

### **배경**

- 함수 인라인하기를 하면 유용한 것만 남기고 나머지는 제거할 수 있다
- 리팩터링 과정에서 잘못 추출된 함수들도 다시 인라인한다
- 간접 호추을 너무 과하게 쓰는 코드도 흔한 인라인 대상이다
- 다른 함수로 단순히 위임하기만 하는 함수들이 너무 많아서 위임 관계가 복잡하게 얽혀있으면 인라인 해버린다

### **절차**

1. 다형 메서드인지 확인한다(서브클래스에서 오버랄이드하는 메서드는 인라인 하면 안된다)
2. 인라인할 함수를 호출하는 곳을 모두 찾는다
3. 각 호출문을 함수 본문으로 교체한다
4. 함수 정의(원래 함수)를 삭제한다

### **예시**

- **InlineFunctionExample.md 파일 참조**

## <U>6.3 변수 추출하기</U>

### **배경**

- 표현식이 너무 복잡하면 이해하기 어려운데, 이러 때 지역 변수를 활용하면 표현식을 쪼개 관리하기 더 쉽게 만들 수 있다
- 이 과정에서 추가한 변수는 디버거에 중단점을 지정하거나 상태를 출력하는 문장을 추가할수 있기 때문에 디버깅에도 도움이 된다
- 현재 함수 안에서만 의미가 있다면 변수로 추출하는것이 좋다

### **절차**

1. 추추하려는 표현식에 부작용은 없는지 확인한다
2. 불변 변수르 하나 선언하고 이름을 붙일 표현식의 복제본을 대입한다
3. 원본 표현식을 새로 만든 변수로 교체한다
4. 테스트한다
5. 표현식을 여러 곳에서 사용한다면 각각을 새로 만든 변수로 교체한다. 하나 교체할 때마다 테스트한다

### **예시**

- **ExtractVariableExample.md 파일 참조**

## <U>6.4 변수 인라인하기</U>

### **배경**

- 변수는 함수 안에서 표현식을 가리키는 이름으로 쓰이며 대체로 긍정적인 효과를 주지만, 그 이름이 원래 표현식과 다를바 없을 때도 있다
- 변수가 주변 코드를 리팩터링 하는데 방해가 되기도 한다
- 이럴 때는 그 변수를 인라인하는 것이 좋다

### **절차**

1. 대입문의 우변(표현식)에서 부작용이 생기지는 않는지 확인한다
2. 변수가 불변으로 선언되지 않았다면 불변으로 만든 후 테스트한다 (이렇게 하면 변수에 값이 단 한 번만 대입되는지 확인할 수 있다)
3. 이 변수를 가장 처음 사용하는 코드를 찾아서 대입문 우변의 코드로 바꾼다
4. 태스트한다
5. 변수를 사용하는 부분을 모두 교체할 때까지 이 과정을 반복한다
6. 변수 선언문과 대입문을 지운다
7. 테스트한다
